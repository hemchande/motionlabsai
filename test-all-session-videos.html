<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Session Videos Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .video-test {
            background: #2a2a2a;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .video-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 15px 0;
        }
        video {
            width: 100%;
            border-radius: 4px;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background: #1a2a1a; color: #4ade80; }
        .error { background: #2a1a1a; color: #f87171; }
        .loading { background: #2a2a1a; color: #fbbf24; }
        .info { background: #1a1a2a; color: #4a9eff; }
        .metrics {
            background: #3a3a3a;
            padding: 15px;
            border-radius: 4px;
            font-size: 12px;
        }
        .test-button {
            background: #4a9eff;
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #3a8eff;
        }
        .summary {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ All Session Videos Test</h1>
        <p>Testing all videos from the SessionDashboard with analytics and video playback</p>
        
        <div class="summary">
            <h2>üìä Test Summary</h2>
            <div id="summary">Running tests...</div>
        </div>
        
        <div id="videoTests"></div>
    </div>

    <script>
        const videos = [
            { name: 'pdtyUo5UELk.mp4', description: 'Simone Biles - Floor Exercise' },
            { name: 'UgWHozR_LLA.mp4', description: 'Katelyn Ohashi - Balance Beam' },
            { name: 'MeLfAr3GY6w.mp4', description: 'Simone Biles - Vault' },
            { name: '3-gNgU9Z_jU.mp4', description: 'Katelyn Ohashi - Floor Exercise' }
        ];
        
        let testResults = {};
        
        function createVideoTest(video) {
            const testId = `test-${video.name.replace(/[^a-zA-Z0-9]/g, '')}`;
            
            return `
                <div class="video-test" id="${testId}">
                    <h3>üé¨ ${video.name}</h3>
                    <p>${video.description}</p>
                    
                    <div class="status loading" id="${testId}-status">Initializing...</div>
                    
                    <div class="video-container">
                        <div>
                            <h4>Video Playback</h4>
                            <video id="${testId}-video" controls preload="metadata">
                                <source src="http://localhost:5004/downloadPerFrameVideo?video_filename=${video.name}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                            <div>
                                <button class="test-button" onclick="testVideo('${testId}')">Test Video</button>
                                <button class="test-button" onclick="testAnalytics('${testId}')">Test Analytics</button>
                            </div>
                        </div>
                        
                        <div>
                            <h4>Analytics Data</h4>
                            <div class="metrics" id="${testId}-metrics">Loading...</div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function updateStatus(testId, message, type = 'info') {
            const statusEl = document.getElementById(`${testId}-status`);
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }
        
        function updateMetrics(testId, data) {
            const metricsEl = document.getElementById(`${testId}-metrics`);
            
            if (data.success) {
                const stats = data.enhanced_statistics;
                metricsEl.innerHTML = `
                    <div><strong>‚úÖ Analytics Loaded</strong></div>
                    <div>üìä Frames: ${data.frames_processed}</div>
                    <div>üéØ Enhanced: ${data.enhanced_analytics ? 'Yes' : 'No'}</div>
                    ${stats.acl_risk_analysis ? `
                        <div><strong>ACL Risk Analysis:</strong></div>
                        <div>‚Ä¢ Average Risk: ${stats.acl_risk_analysis.average_overall_risk.toFixed(1)}%</div>
                        <div>‚Ä¢ High Risk Frames: ${stats.acl_risk_analysis.high_risk_frames}</div>
                        <div>‚Ä¢ Risk Distribution: L:${stats.acl_risk_analysis.risk_level_distribution.LOW} M:${stats.acl_risk_analysis.risk_level_distribution.MODERATE} H:${stats.acl_risk_analysis.risk_level_distribution.HIGH}</div>
                    ` : ''}
                    ${stats.movement_analysis ? `
                        <div><strong>Movement Analysis:</strong></div>
                        <div>‚Ä¢ Avg Elevation: ${stats.movement_analysis.average_elevation_angle.toFixed(1)}¬∞</div>
                        <div>‚Ä¢ Max Elevation: ${stats.movement_analysis.max_elevation_angle.toFixed(1)}¬∞</div>
                    ` : ''}
                `;
            } else {
                metricsEl.innerHTML = `<div class="error">‚ùå Failed to load analytics</div>`;
            }
        }
        
        async function testVideo(testId) {
            const video = document.getElementById(`${testId}-video`);
            updateStatus(testId, 'Testing video playback...', 'loading');
            
            try {
                // Test if video can load
                await new Promise((resolve, reject) => {
                    video.addEventListener('loadedmetadata', resolve);
                    video.addEventListener('error', reject);
                    video.load();
                });
                
                updateStatus(testId, '‚úÖ Video loaded successfully', 'success');
                testResults[testId] = { ...testResults[testId], video: true };
                
            } catch (error) {
                updateStatus(testId, `‚ùå Video failed: ${error.message}`, 'error');
                testResults[testId] = { ...testResults[testId], video: false };
            }
            
            updateSummary();
        }
        
        async function testAnalytics(testId) {
            const videoName = testId.replace('test-', '').replace(/[A-Z]/g, (match, index) => {
                if (index === 0) return match.toLowerCase();
                return '-' + match.toLowerCase();
            }) + '.mp4';
            
            updateStatus(testId, 'Testing analytics...', 'loading');
            
            try {
                const response = await fetch(`http://localhost:5004/getPerFrameStatistics?video_filename=${videoName}`);
                const data = await response.json();
                
                if (data.success || data.enhanced_analytics) {
                    updateStatus(testId, '‚úÖ Analytics loaded successfully', 'success');
                    updateMetrics(testId, data);
                    testResults[testId] = { ...testResults[testId], analytics: true };
                } else {
                    updateStatus(testId, `‚ùå Analytics failed: ${data.error}`, 'error');
                    testResults[testId] = { ...testResults[testId], analytics: false };
                }
                
            } catch (error) {
                updateStatus(testId, `‚ùå Analytics failed: ${error.message}`, 'error');
                testResults[testId] = { ...testResults[testId], analytics: false };
            }
            
            updateSummary();
        }
        
        function updateSummary() {
            const summaryEl = document.getElementById('summary');
            const results = Object.values(testResults);
            
            if (results.length === 0) {
                summaryEl.innerHTML = 'Running tests...';
                return;
            }
            
            const totalTests = results.length;
            const videoSuccess = results.filter(r => r.video).length;
            const analyticsSuccess = results.filter(r => r.analytics).length;
            
            summaryEl.innerHTML = `
                <div><strong>üìä Test Results:</strong></div>
                <div>üé¨ Videos: ${videoSuccess}/${totalTests} working</div>
                <div>üìà Analytics: ${analyticsSuccess}/${totalTests} working</div>
                <div>üéØ Overall: ${videoSuccess === totalTests && analyticsSuccess === totalTests ? '‚úÖ All tests passed!' : '‚ö†Ô∏è Some tests failed'}</div>
            `;
        }
        
        function runAllTests() {
            videos.forEach(video => {
                const testId = `test-${video.name.replace(/[^a-zA-Z0-9]/g, '')}`;
                setTimeout(() => testVideo(testId), 1000);
                setTimeout(() => testAnalytics(testId), 2000);
            });
        }
        
        // Initialize
        document.getElementById('videoTests').innerHTML = videos.map(createVideoTest).join('');
        
        // Auto-run tests after a delay
        setTimeout(runAllTests, 1000);
    </script>
</body>
</html>













