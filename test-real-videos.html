<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Videos & Analytics Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .video-test {
            background: #2a2a2a;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .video-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 15px 0;
        }
        video {
            width: 100%;
            border-radius: 4px;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background: #1a2a1a; color: #4ade80; }
        .error { background: #2a1a1a; color: #f87171; }
        .loading { background: #2a2a1a; color: #fbbf24; }
        .info { background: #1a1a2a; color: #4a9eff; }
        .metrics {
            background: #3a3a3a;
            padding: 15px;
            border-radius: 4px;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .test-button {
            background: #4a9eff;
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #3a8eff;
        }
        .summary {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .file-info {
            background: #3a3a3a;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Real Videos & Analytics Test</h1>
        <p>Testing real API-generated videos with actual frame-by-frame analytics data</p>
        
        <div class="summary">
            <h2>üìä Test Summary</h2>
            <div id="summary">Running tests...</div>
        </div>
        
        <div id="videoTests"></div>
    </div>

    <script>
        const videos = [
            { 
                name: 'pdtyUo5UELk.mp4', 
                description: 'Simone Biles - Floor Exercise',
                expectedSize: '2.1M',
                expectedFrames: 119
            },
            { 
                name: 'UgWHozR_LLA.mp4', 
                description: 'Katelyn Ohashi - Balance Beam',
                expectedSize: '242M',
                expectedFrames: 4136
            },
            { 
                name: 'MeLfAr3GY6w.mp4', 
                description: 'Simone Biles - Vault',
                expectedSize: '78M',
                expectedFrames: 1146
            }
        ];
        
        let testResults = {};
        
        function createVideoTest(video) {
            const testId = `test-${video.name.replace(/[^a-zA-Z0-9]/g, '')}`;
            
            return `
                <div class="video-test" id="${testId}">
                    <h3>üé¨ ${video.name}</h3>
                    <p>${video.description}</p>
                    <div class="file-info">
                        <strong>Expected:</strong> ${video.expectedSize} video, ${video.expectedFrames} frames
                    </div>
                    
                    <div class="status loading" id="${testId}-status">Initializing...</div>
                    
                    <div class="video-container">
                        <div>
                            <h4>Video Playback</h4>
                            <video id="${testId}-video" controls preload="metadata">
                                <source src="http://localhost:5004/downloadPerFrameVideo?video_filename=${video.name}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                            <div>
                                <button class="test-button" onclick="testVideo('${testId}')">Test Video</button>
                                <button class="test-button" onclick="testAnalytics('${testId}')">Test Analytics</button>
                                <button class="test-button" onclick="testFileSize('${testId}')">Check File Size</button>
                            </div>
                        </div>
                        
                        <div>
                            <h4>Analytics Data</h4>
                            <div class="metrics" id="${testId}-metrics">Loading...</div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function updateStatus(testId, message, type = 'info') {
            const statusEl = document.getElementById(`${testId}-status`);
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }
        
        function updateMetrics(testId, data) {
            const metricsEl = document.getElementById(`${testId}-metrics`);
            
            if (data.success || data.enhanced_analytics) {
                const stats = data.enhanced_statistics || {};
                const frameCount = data.frames_processed || data.frame_data?.length || 0;
                
                metricsEl.innerHTML = `
                    <div><strong>‚úÖ Analytics Loaded</strong></div>
                    <div>üìä Total Frames: ${frameCount}</div>
                    <div>üéØ Enhanced Analytics: ${data.enhanced_analytics ? 'Yes' : 'No'}</div>
                    <div>‚è±Ô∏è Processing Time: ${data.processing_time || 'N/A'}</div>
                    
                    ${stats.acl_risk_analysis ? `
                        <div><strong>ACL Risk Analysis:</strong></div>
                        <div>‚Ä¢ Average Overall Risk: ${stats.acl_risk_analysis.average_overall_risk?.toFixed(1) || '0'}%</div>
                        <div>‚Ä¢ High Risk Frames: ${stats.acl_risk_analysis.high_risk_frames || 0}</div>
                        <div>‚Ä¢ Risk Distribution: L:${stats.acl_risk_analysis.risk_level_distribution?.LOW || 0} M:${stats.acl_risk_analysis.risk_level_distribution?.MODERATE || 0} H:${stats.acl_risk_analysis.risk_level_distribution?.HIGH || 0}</div>
                    ` : ''}
                    
                    ${stats.movement_analysis ? `
                        <div><strong>Movement Analysis:</strong></div>
                        <div>‚Ä¢ Avg Elevation: ${stats.movement_analysis.average_elevation_angle?.toFixed(1) || '0'}¬∞</div>
                        <div>‚Ä¢ Max Elevation: ${stats.movement_analysis.max_elevation_angle?.toFixed(1) || '0'}¬∞</div>
                        <div>‚Ä¢ Avg Height: ${stats.movement_analysis.average_height_from_ground?.toFixed(3) || '0'}m</div>
                    ` : ''}
                    
                    ${stats.tumbling_detection ? `
                        <div><strong>Tumbling Detection:</strong></div>
                        <div>‚Ä¢ Tumbling Frames: ${stats.tumbling_detection.total_tumbling_frames || 0}</div>
                        <div>‚Ä¢ Tumbling %: ${stats.tumbling_detection.tumbling_percentage?.toFixed(1) || '0'}%</div>
                    ` : ''}
                    
                    <div><strong>Sample Frame Data:</strong></div>
                    <div>‚Ä¢ Frame 1: ${data.frame_data?.[0]?.timestamp?.toFixed(2) || 'N/A'}s</div>
                    <div>‚Ä¢ Frame 100: ${data.frame_data?.[99]?.timestamp?.toFixed(2) || 'N/A'}s</div>
                    <div>‚Ä¢ Last Frame: ${data.frame_data?.[data.frame_data.length-1]?.timestamp?.toFixed(2) || 'N/A'}s</div>
                `;
            } else {
                metricsEl.innerHTML = `<div class="error">‚ùå Failed to load analytics: ${data.error || 'Unknown error'}</div>`;
            }
        }
        
        async function testVideo(testId) {
            const video = document.getElementById(`${testId}-video`);
            updateStatus(testId, 'Testing video playback...', 'loading');
            
            try {
                // Test if video can load
                await new Promise((resolve, reject) => {
                    video.addEventListener('loadedmetadata', resolve);
                    video.addEventListener('error', reject);
                    video.load();
                });
                
                updateStatus(testId, '‚úÖ Video loaded successfully', 'success');
                testResults[testId] = { ...testResults[testId], video: true };
                
            } catch (error) {
                updateStatus(testId, `‚ùå Video failed: ${error.message}`, 'error');
                testResults[testId] = { ...testResults[testId], video: false };
            }
            
            updateSummary();
        }
        
        async function testAnalytics(testId) {
            const videoName = testId.replace('test-', '').replace(/[A-Z]/g, (match, index) => {
                if (index === 0) return match.toLowerCase();
                return '-' + match.toLowerCase();
            }) + '.mp4';
            
            updateStatus(testId, 'Testing analytics...', 'loading');
            
            try {
                const response = await fetch(`http://localhost:5004/getPerFrameStatistics?video_filename=${videoName}`);
                const data = await response.json();
                
                if (data.success || data.enhanced_analytics) {
                    updateStatus(testId, '‚úÖ Analytics loaded successfully', 'success');
                    updateMetrics(testId, data);
                    testResults[testId] = { ...testResults[testId], analytics: true };
                } else {
                    updateStatus(testId, `‚ùå Analytics failed: ${data.error}`, 'error');
                    testResults[testId] = { ...testResults[testId], analytics: false };
                }
                
            } catch (error) {
                updateStatus(testId, `‚ùå Analytics failed: ${error.message}`, 'error');
                testResults[testId] = { ...testResults[testId], analytics: false };
            }
            
            updateSummary();
        }
        
        async function testFileSize(testId) {
            const videoName = testId.replace('test-', '').replace(/[A-Z]/g, (match, index) => {
                if (index === 0) return match.toLowerCase();
                return '-' + match.toLowerCase();
            }) + '.mp4';
            
            updateStatus(testId, 'Checking file size...', 'loading');
            
            try {
                const response = await fetch(`http://localhost:5004/downloadPerFrameVideo?video_filename=${videoName}`, {
                    method: 'HEAD'
                });
                
                const contentLength = response.headers.get('content-length');
                const sizeMB = (contentLength / (1024 * 1024)).toFixed(1);
                
                updateStatus(testId, `‚úÖ File size: ${sizeMB}MB`, 'success');
                testResults[testId] = { ...testResults[testId], fileSize: sizeMB };
                
            } catch (error) {
                updateStatus(testId, `‚ùå File size check failed: ${error.message}`, 'error');
                testResults[testId] = { ...testResults[testId], fileSize: 'error' };
            }
            
            updateSummary();
        }
        
        function updateSummary() {
            const summaryEl = document.getElementById('summary');
            const results = Object.values(testResults);
            
            if (results.length === 0) {
                summaryEl.innerHTML = 'Running tests...';
                return;
            }
            
            const totalTests = results.length;
            const videoSuccess = results.filter(r => r.video).length;
            const analyticsSuccess = results.filter(r => r.analytics).length;
            const fileSizeSuccess = results.filter(r => r.fileSize && r.fileSize !== 'error').length;
            
            summaryEl.innerHTML = `
                <div><strong>üìä Test Results:</strong></div>
                <div>üé¨ Videos: ${videoSuccess}/${totalTests} working</div>
                <div>üìà Analytics: ${analyticsSuccess}/${totalTests} working</div>
                <div>üìÅ File Sizes: ${fileSizeSuccess}/${totalTests} checked</div>
                <div>üéØ Overall: ${videoSuccess === totalTests && analyticsSuccess === totalTests ? '‚úÖ All tests passed!' : '‚ö†Ô∏è Some tests failed'}</div>
            `;
        }
        
        function runAllTests() {
            videos.forEach(video => {
                const testId = `test-${video.name.replace(/[^a-zA-Z0-9]/g, '')}`;
                setTimeout(() => testVideo(testId), 1000);
                setTimeout(() => testAnalytics(testId), 2000);
                setTimeout(() => testFileSize(testId), 3000);
            });
        }
        
        // Initialize
        document.getElementById('videoTests').innerHTML = videos.map(createVideoTest).join('');
        
        // Auto-run tests after a delay
        setTimeout(runAllTests, 1000);
    </script>
</body>
</html>















