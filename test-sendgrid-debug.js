// Debug SendGrid Integration
// Run with: node test-sendgrid-debug.js

const sgMail = require('@sendgrid/mail');

// Your SendGrid API key
const SENDGRID_API_KEY = process.env.SENDGRID_API_KEY || 'YOUR_SENDGRID_API_KEY_HERE';

console.log('ğŸ” Debugging SendGrid Integration...\n');

// Set API key
sgMail.setApiKey(SENDGRID_API_KEY);

// Test email data - using a more standard approach
const testEmail = {
  to: 'eh52@rice.edu', // Your email
  from: {
    email: 'connectarts00@gmail.com',
    name: 'Gymnastics Analytics Test'
  },
  subject: 'ğŸ§ª SendGrid Test - Gymnastics Analytics',
  text: `SendGrid Integration Test - ${new Date().toLocaleString()}`,
  html: `
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <title>SendGrid Test</title>
    </head>
    <body>
      <h1>ğŸ§ª SendGrid Integration Test</h1>
      <p>This is a test email to verify SendGrid integration with Gymnastics Analytics.</p>
      <p><strong>Status:</strong> âœ… Working!</strong></p>
      <p><strong>Time:</strong> ${new Date().toLocaleString()}</p>
      <p><strong>Message ID:</strong> Will be generated by SendGrid</p>
      <hr>
      <p><em>If you receive this email, SendGrid is working correctly!</em></p>
    </body>
    </html>
  `
};

async function testSendGridDebug() {
  try {
    console.log('ğŸ“§ Attempting to send test email...');
    console.log('ğŸ“¨ To:', testEmail.to);
    console.log('ğŸ“¤ From:', testEmail.from.email);
    console.log('ğŸ“ Subject:', testEmail.subject);
    
    const response = await sgMail.send(testEmail);
    
    console.log('\nâœ… Email sent successfully!');
    console.log('ğŸ“¨ Message ID:', response[0]?.headers['x-message-id'] || 'unknown');
    console.log('ğŸ“¤ Response Status:', response[0]?.statusCode || 'unknown');
    console.log('ğŸ“‹ Response Headers:', JSON.stringify(response[0]?.headers, null, 2));
    
    console.log('\nğŸ” Next Steps:');
    console.log('1. Check your inbox at:', testEmail.to);
    console.log('2. Check your spam/junk folder');
    console.log('3. Wait 2-5 minutes for delivery');
    console.log('4. Check SendGrid dashboard for delivery status');
    
    console.log('\nğŸ‰ SendGrid integration is working correctly!');
    
  } catch (error) {
    console.error('\nâŒ Error sending email:', error.message);
    
    if (error.response) {
      console.error('ğŸ“‹ Error Details:', error.response.body);
    }
    
    console.log('\nğŸ”§ Troubleshooting Steps:');
    console.log('1. Check SendGrid dashboard for sender verification');
    console.log('2. Verify API key permissions');
    console.log('3. Check sending limits and account status');
    console.log('4. Ensure "from" email is verified in SendGrid');
  }
}

// Run the test
testSendGridDebug();










